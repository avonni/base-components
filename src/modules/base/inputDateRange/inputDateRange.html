<template>
    <div
        class={computedWrapperClass}
        data-element-id="div-wrapper"
        onfocusout={handleFocusOut}
    >
        <div class={computedLabelClass}>
            <abbr
                if:true={required}
                class="slds-required"
                title={requiredAlternativeText}
            >
                *
            </abbr>
            <p if:true={label} data-element-id="p-label">{label}</p>
            <lightning-helptext
                if:true={fieldLevelHelp}
                content={fieldLevelHelp}
                data-element-id="lightning-helptext"
            ></lightning-helptext>
        </div>
        <div
            if:true={showOptions}
            class="slds-grid slds-wrap slds-m-bottom_x-small"
        >
            <c-combobox
                disabled={disabled}
                name="predefined-ranges"
                options={rangeOptions}
                value={predefinedRangeValue}
                variant="label-hidden"
                data-element-id="avonni-input-date-range__combobox-range-options"
                onblur={handleBlur}
                onchange={handleChangeRangeOption}
                onfocus={handleFocus}
            ></c-combobox>
        </div>
        <div class="slds-grid slds-wrap">
            <div class="slds-grid slds-wrap">
                <div
                    class="
                        slds-form-element
                        slds-scrollable_none
                        slds-m-bottom_xxx-small
                    "
                >
                    <label
                        if:true={labelStartDate}
                        class="
                            slds-form-element__label
                            avonni-input-date-range__labels
                        "
                        for="start-date"
                        id="start-date-input-label"
                        >{labelStartDate}
                    </label>
                    <div
                        if:false={readOnly}
                        class="
                            slds-form-element__control
                            slds-input-has-icon slds-input-has-icon_right
                        "
                    >
                        <input
                            class="slds-input"
                            autocomplete="off"
                            disabled={disabled}
                            required={required}
                            type="text"
                            value={startDateString}
                            data-element-id="input-start-date"
                            onblur={handleBlurStartInput}
                            onclick={handleClickDateInput}
                            onfocus={handleFocus}
                            onkeydown={handleInputKeyDown}
                        />
                        <lightning-button-icon
                            class="slds-input__icon slds-input__icon_right"
                            icon-name="utility:event"
                            size="medium"
                            variant="bare"
                            data-element-id="lightning-icon-start-date"
                            onblur={handleBlurStartButtonIcon}
                            onclick={handleClickDateInput}
                            onfocus={handleFocus}
                            onkeydown={handleInputKeyDown}
                        ></lightning-button-icon>
                    </div>
                    <div
                        if:true={showStartDate}
                        class="slds-datepicker slds-dropdown slds-is-fixed"
                        data-element-id="div-start-date-dropdown"
                    >
                        <c-focus-trap
                            data-element-id="calendar-start-date-dialog"
                            onblur={handleBlur}
                            onfocus={handleFocus}
                            onfocusin={handleStartCalendarFocusIn}
                            onfocusout={handleStartCalendarFocusOut}
                            onkeydown={handleCalendarDialogKeyDown}
                        >
                            <c-calendar
                                aria-label="Start date input calendar"
                                selection-mode={selectionModeStartDate}
                                timezone={timezone}
                                value={calendarValue}
                                week-start-day={weekStartDay}
                                data-element-id="calendar-start-date"
                                data-is-focusable
                                onblur={handleBlur}
                                onchange={handleChangeStartDate}
                                onfocus={handleFocus}
                            ></c-calendar>
                            <div class="slds-align_absolute-center">
                                <lightning-button
                                    label={todayButtonLabel}
                                    variant="base"
                                    data-element-id="select-start-today-button"
                                    data-is-focusable
                                    onblur={handleBlur}
                                    onclick={handleSelectStartToday}
                                    onfocus={handleFocus}
                                ></lightning-button>
                            </div>
                        </c-focus-trap>
                    </div>
                    <p if:true={readOnly} data-element-id="start-date">
                        {startDateString}
                    </p>
                </div>
                <div if:true={showTime} class="slds-form-element">
                    <label
                        if:true={labelStartTime}
                        class="
                            slds-form-element__label
                            avonni-input-date-range__labels
                        "
                        for="start-time"
                        >{labelStartTime}
                    </label>
                    <lightning-input
                        if:false={readOnly}
                        class="start-time"
                        disabled={disabled}
                        label="Start time"
                        name="start-time"
                        time-style={timeStyle}
                        type="time"
                        value={startTime}
                        variant="label-hidden"
                        data-element-id="lightning-input-start-time"
                        onblur={handleBlur}
                        onchange={handleChangeStartTime}
                        onfocus={handleFocus}
                    ></lightning-input>
                    <p if:true={readOnly} data-element-id="start-time">
                        {startTimeString}
                    </p>
                </div>
            </div>
            <div class="slds-grid slds-wrap">
                <div
                    class="
                        slds-form-element
                        slds-scrollable_none
                        slds-m-bottom_xxx-small
                    "
                >
                    <label
                        if:true={labelEndDate}
                        class="
                            slds-form-element__label
                            avonni-input-date-range__labels
                        "
                        for="end-date"
                        >{labelEndDate}
                    </label>
                    <div
                        if:false={readOnly}
                        class="
                            slds-form-element__control
                            slds-input-has-icon slds-input-has-icon_right
                        "
                    >
                        <input
                            class="slds-input"
                            autocomplete="off"
                            disabled={disabled}
                            type="text"
                            value={endDateString}
                            data-element-id="input-end-date"
                            onblur={handleBlurEndInput}
                            onclick={handleClickDateInput}
                            onfocus={handleFocus}
                            onkeydown={handleInputKeyDown}
                        />
                        <lightning-button-icon
                            class="slds-input__icon slds-input__icon_right"
                            icon-name="utility:event"
                            size="medium"
                            variant="bare"
                            data-element-id="lightning-icon-end-date"
                            onblur={handleBlurEndButtonIcon}
                            onclick={handleClickDateInput}
                            onfocus={handleFocus}
                            onkeydown={handleInputKeyDown}
                        ></lightning-button-icon>
                    </div>
                    <div
                        if:true={showEndDate}
                        class="slds-datepicker slds-dropdown slds-is-fixed"
                        data-element-id="div-end-date-dropdown"
                    >
                        <c-focus-trap
                            data-element-id="calendar-end-date-dialog"
                            onblur={handleBlur}
                            onfocus={handleFocus}
                            onfocusin={handleEndCalendarFocusIn}
                            onfocusout={handleEndCalendarFocusOut}
                            onkeydown={handleCalendarDialogKeyDown}
                        >
                            <c-calendar
                                aria-label="End date input calendar"
                                selection-mode={selectionModeEndDate}
                                timezone={timezone}
                                value={calendarValue}
                                week-start-day={weekStartDay}
                                data-element-id="calendar-end-date"
                                data-is-focusable
                                onblur={handleBlur}
                                onchange={handleChangeEndDate}
                                onfocus={handleFocus}
                            ></c-calendar>
                            <div class="slds-align_absolute-center">
                                <lightning-button
                                    label={todayButtonLabel}
                                    variant="base"
                                    data-element-id="select-end-today-button"
                                    data-is-focusable
                                    onblur={handleBlur}
                                    onclick={handleSelectEndToday}
                                    onfocus={handleFocus}
                                ></lightning-button>
                            </div>
                        </c-focus-trap>
                    </div>
                    <p if:true={readOnly} data-element-id="end-date">
                        {endDateString}
                    </p>
                </div>
                <div if:true={showTime} class="slds-form-element">
                    <label
                        if:true={labelEndTime}
                        class="
                            slds-form-element__label
                            avonni-input-date-range__labels
                        "
                        for="end-time"
                        >{labelEndTime}
                    </label>
                    <lightning-input
                        if:false={readOnly}
                        label="end time"
                        name="end-time"
                        time-style={timeStyle}
                        type="time"
                        value={endTime}
                        variant="label-hidden"
                        disabled={disabled}
                        data-element-id="lightning-input-end-time"
                        onblur={handleBlur}
                        onchange={handleChangeEndTime}
                        onfocus={handleFocus}
                    ></lightning-input>
                    <p if:true={readOnly} data-element-id="end-time">
                        {endTimeString}
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div if:true={helpMessage} class="slds-has-error">
        <div
            id="help-message"
            class="slds-form-element__help"
            data-help-message
            role="alert"
        >
            {helpMessage}
        </div>
    </div>
</template>
