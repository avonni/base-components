<template>
    <table
        class={computedTableClasses}
        aria-labelledby="month"
        aria-multiselectable={isMultiSelect}
        role="grid"
        onkeydown={handleKeyDown}
    >
        <!-- Weekdays headers -->
        <thead>
            <tr id="weekdays" role="row">
                <template for:each={weekdays} for:item="day" for:index="index">
                    <th
                        key={day}
                        id={index}
                        role="columnheader"
                        scope="col"
                        data-element-id="th"
                        class="avonni-calendar__weekdays_color"
                    >
                        <abbr>{day}</abbr>
                    </th>
                </template>
            </tr>
        </thead>

        <!-- Days -->
        <tbody>
            <template for:each={calendarData} for:item="week">
                <tr
                    class="avonni-calendar__table-row slds-has-multi-selection"
                    key={generateKey}
                    role="row"
                >
                    <template for:each={week} for:item="day">
                        <td
                            key={generateKey}
                            class={day.wrapperClass}
                            aria-current={day.ariaCurrent}
                            aria-disabled={day.disabled}
                            aria-selected={day.computedAriaSelected}
                            role="gridcell"
                            tabindex={day.tabIndex}
                            data-date={day.label}
                            data-disabled={day.disabled}
                            data-element-id="td"
                            data-full-date={day.ts}
                            data-selected={day.appearsSelected}
                            data-today={day.isToday}
                            onblur={handleBlur}
                            onfocus={handleDateFocus}
                            onmouseout={handleMouseOut}
                            onmouseover={handleMouseOver}
                        >
                            <span
                                if:false={day.isDateInvisible}
                                class="slds-assistive-text"
                                data-element-id="day-label-assistive-text"
                            >
                                {day.computedAriaLabel}
                            </span>
                            <span
                                class={day.labelClass}
                                aria-hidden="true"
                                data-full-date={day.ts}
                                data-date={day.label}
                                data-disabled={day.disabled}
                                data-element-id="span-day-label"
                                onclick={handleSelectDate}
                            >
                                {day.label}
                            </span>
                            <template if:false={day.isDateInvisible}>
                                <div
                                    if:true={day.markers.length}
                                    class="slds-is-relative"
                                >
                                    <div
                                        class="
                                            avonni-calendar__marker-container
                                        "
                                    >
                                        <template
                                            for:each={day.markers}
                                            for:item="marker"
                                        >
                                            <div
                                                key={generateKey}
                                                style={marker}
                                                class="
                                                    avonni-calendar__marked-cells
                                                "
                                                data-element-id="div-marked-cells"
                                            ></div>
                                        </template>
                                    </div>
                                </div>
                                <c-chip
                                    if:true={day.hasChip}
                                    class={day.chip.computedClass}
                                    label={day.chip.label}
                                    outline={day.chip.outline}
                                    variant={day.chip.variant}
                                    data-full-date={day.ts}
                                    data-element-id="chip-date-label"
                                >
                                    <c-primitive-icon
                                        if:true={day.chip.showLeftIcon}
                                        class="avonni-calendar-chip-icon-left"
                                        icon-name={day.chip.iconName}
                                        slot="left"
                                        size="xx-small"
                                        variant={day.chip.iconVariant}
                                        data-full-date={day.ts}
                                    ></c-primitive-icon>
                                    <c-primitive-icon
                                        if:true={day.chip.showRightIcon}
                                        class="avonni-calendar-chip-icon-right"
                                        icon-name={day.chip.iconName}
                                        slot="right"
                                        size="xx-small"
                                        variant={day.chip.iconVariant}
                                        data-full-date={day.ts}
                                    ></c-primitive-icon>
                                </c-chip>
                            </template>
                        </td>
                    </template>
                </tr>
            </template>
        </tbody>
    </table>
</template>
