<template>
    <div data-element-id="container">
        <fieldset
            class="avonni-input-choice-set__fieldset"
            aria-required={required}
        >
            <div class={computedLegendClass}>
                <legend class={computedHeaderClass}>
                    <abbr
                        if:true={required}
                        class="slds-required"
                        title={requiredAlternativeText}
                        data-element-id="abbr"
                    >
                        *
                    </abbr>
                    {label}
                </legend>
                <lightning-helptext
                    if:true={fieldLevelHelp}
                    content={fieldLevelHelp}
                    data-element-id="lightning-helptext"
                ></lightning-helptext>
            </div>
            <div class="slds-form-element__control">
                <div
                    if:true={isLoading}
                    class="slds-is-relative avonni-input-choice-set__loading"
                >
                    <lightning-spinner
                        alternative-text={loadingStateAlternativeText}
                        size="small"
                        data-element-id="lightning-spinner-loading"
                    ></lightning-spinner>
                </div>
                <c-primitive-scrollable-container
                    if:false={isLoading}
                    class="
                        avonni-input-choice-set__primitive-scrollable-container
                    "
                    disabled={horizontalOverflowIsDisabled}
                    menu-variant={showMoreMenuVariant}
                    show-menu={displayShowMoreMenu}
                    show-scroll-buttons={computedOrientationAttributes.showScrollButtons}
                    data-element-id="avonni-primitive-scrollable-container"
                    onwidthchange={handleWidthChange}
                >
                    <div
                        class={computedButtonClass}
                        data-element-id="input-group"
                    >
                        <c-layout
                            if:true={hasLayoutItem}
                            class="slds-size_full"
                            direction={computedDirection}
                            multiple-rows={computedOrientationAttributes.multipleRows}
                            vertical-align={computedVerticalAlign}
                            data-element-id="layout"
                        >
                            <!-- Vertical/Horizontal toggle, checkbox, radio and displayAsRow button -->
                            <template
                                for:each={visibleOptions}
                                for:item="option"
                            >
                                <c-layout-item
                                    if:false={option.hidden}
                                    key={option.value}
                                    class="slds-grid"
                                    grow="1"
                                    large-container-size={computedOrientationAttributes.largeContainerCols}
                                    medium-container-size={computedOrientationAttributes.mediumContainerCols}
                                    shrink="0"
                                    size={computedOrientationAttributes.cols}
                                    small-container-size={computedOrientationAttributes.smallContainerCols}
                                    data-element-id="layout-item"
                                >
                                    <span
                                        class={computedInputContainerClass}
                                        data-element-id="span-checkbox-container"
                                        data-value={option.value}
                                        onmouseenter={handleEnter}
                                        onmouseleave={handleLeave}
                                    >
                                        <input
                                            class={computedInputClass}
                                            disabled={option.disabled}
                                            id={option.value}
                                            name={name}
                                            readonly={readOnly}
                                            type={computedInputType}
                                            value={option.value}
                                            data-checked={option.isChecked}
                                            data-color={option.color}
                                            data-element-id="input"
                                            onchange={handleChange}
                                            onclick={handleClick}
                                            onfocus={handleFocus}
                                            onblur={handleBlur}
                                            onkeyup={handleKeyUp}
                                        />
                                        <label
                                            for={option.value}
                                            class={option.computedLabelClass}
                                            style={option.computedButtonLabelStyle}
                                            data-color={option.color}
                                            data-element-id="label"
                                            data-value={option.value}
                                        >
                                            <div
                                                if:false={buttonVariant}
                                                class={computedCheckLabelClass}
                                                data-element-id="div-check-label"
                                            >
                                                <div
                                                    class={computedCheckContainerClass}
                                                    style={option.computedFauxInputStyle}
                                                    data-element-id="div-check-container"
                                                >
                                                    <span
                                                        if:true={checkboxVariant}
                                                        class={computedCheckboxShapeClass}
                                                    ></span>
                                                    <c-input-toggle
                                                        if:true={toggleVariant}
                                                        aria-label={option.label}
                                                        disabled={option.disabled}
                                                        hide-mark={computedHideCheck}
                                                        label={option.label}
                                                        message-toggle-active={computedTypeAttributes.messageToggleActive}
                                                        message-toggle-inactive={computedTypeAttributes.messageToggleInactive}
                                                        name={option.value}
                                                        readonly={readOnly}
                                                        size={computedTypeAttributes.size}
                                                        value={option.value}
                                                        variant="label-hidden"
                                                        data-element-id="input-toggle"
                                                        data-value={option.value}
                                                        onblur={handleBlur}
                                                        onchange={handleChange}
                                                        onfocus={handleFocus}
                                                    ></c-input-toggle>
                                                </div>
                                                <div
                                                    class={computedLabelContainerClass}
                                                    style={option.computedStyle}
                                                    data-element-id="label-icon-container"
                                                >
                                                    <div
                                                        class="
                                                            slds-show_inline-block
                                                            slds-m-right_x-small
                                                        "
                                                    >
                                                        <div class="slds-grid">
                                                            <lightning-formatted-rich-text
                                                                if:true={option.displayLabel}
                                                                class={computedOptionLabelClass}
                                                                disable-linkify
                                                                title={option.label}
                                                                value={option.label}
                                                                data-element-id="lightning-formatted-rich-text-option-label"
                                                            ></lightning-formatted-rich-text>
                                                            <lightning-formatted-rich-text
                                                                if:true={option.displayAdditionalLabel}
                                                                class="
                                                                    slds-order_2
                                                                    slds-m-left_xxx-small
                                                                "
                                                                disable-linkify
                                                                title={option.additionalLabel}
                                                                value={option.additionalLabel}
                                                            ></lightning-formatted-rich-text>
                                                        </div>
                                                    </div>
                                                    <lightning-icon
                                                        if:true={option.iconName}
                                                        class={option.computedIconClass}
                                                        icon-name={option.iconName}
                                                        size="x-small"
                                                        data-element-id="lightning-icon-checkbox"
                                                    ></lightning-icon>
                                                </div>
                                            </div>
                                            <div
                                                if:true={buttonVariant}
                                                class="slds-grid"
                                            >
                                                <div
                                                    class={option.computedLabelContainerClass}
                                                >
                                                    <span
                                                        if:true={option.isIconBottomOrRight}
                                                        class={option.computedLabelButtonClass}
                                                    >
                                                        {option.label}
                                                    </span>
                                                    <lightning-icon
                                                        if:true={option.iconName}
                                                        class={option.computedIconButtonClass}
                                                        alternative-text={option.alternativeText}
                                                        icon-name={option.iconName}
                                                        size="x-small"
                                                        variant={option.computedVariantButton}
                                                        data-element-id="lightning-icon-button"
                                                    ></lightning-icon>
                                                    <span
                                                        if:true={option.isIconTopOrLeft}
                                                        class={option.computedLabelButtonClass}
                                                    >
                                                        {option.label}
                                                    </span>
                                                </div>
                                                <template
                                                    if:true={computedTypeAttributes.showCheckmark}
                                                >
                                                    <lightning-icon
                                                        class={computedCheckmarkClass}
                                                        style={option.computedCheckmarkStyle}
                                                        icon-name="utility:check"
                                                        size="x-small"
                                                        variant="inverse"
                                                        data-element-id="lightning-icon-check"
                                                    ></lightning-icon>
                                                </template>
                                            </div>
                                        </label>
                                    </span>
                                </c-layout-item>
                            </template>
                        </c-layout>

                        <!-- Vertical buttons -->
                        <template
                            if:false={hasLayoutItem}
                            for:each={visibleOptions}
                            for:item="option"
                        >
                            <span
                                if:false={option.hidden}
                                key={option.value}
                                class={computedButtonContainerClass}
                                data-element-id="span-checkbox-container"
                                data-value={option.value}
                                onmouseenter={handleEnter}
                                onmouseleave={handleLeave}
                            >
                                <input
                                    class={computedInputClass}
                                    disabled={option.disabled}
                                    id={option.value}
                                    name={name}
                                    readonly={readOnly}
                                    type={computedInputType}
                                    value={option.value}
                                    data-checked={option.isChecked}
                                    data-color={option.color}
                                    data-element-id="input"
                                    onblur={handleBlur}
                                    onchange={handleChange}
                                    onclick={handleClick}
                                    onfocus={handleFocus}
                                    onkeyup={handleKeyUp}
                                />
                                <label
                                    for={option.value}
                                    class={option.computedLabelClass}
                                    style={option.computedButtonLabelStyle}
                                    data-color={option.color}
                                    data-element-id="label"
                                    data-value={option.value}
                                >
                                    <div class="slds-grid">
                                        <div
                                            class={option.computedLabelContainerClass}
                                        >
                                            <span
                                                if:true={option.isIconBottomOrRight}
                                                class={option.computedLabelButtonClass}
                                            >
                                                {option.label}
                                            </span>
                                            <lightning-icon
                                                if:true={option.iconName}
                                                class={option.computedIconButtonClass}
                                                alternative-text={option.alternativeText}
                                                icon-name={option.iconName}
                                                size="x-small"
                                                variant={option.computedVariantButton}
                                                data-element-id="lightning-icon-button"
                                            ></lightning-icon>
                                            <span
                                                if:true={option.isIconTopOrLeft}
                                                class={option.computedLabelButtonClass}
                                            >
                                                {option.label}
                                            </span>
                                        </div>
                                        <lightning-icon
                                            if:true={computedTypeAttributes.showCheckmark}
                                            class={computedCheckmarkClass}
                                            style={option.computedCheckmarkStyle}
                                            icon-name="utility:check"
                                            size="x-small"
                                            variant="inverse"
                                            data-element-id="lightning-icon-check"
                                        ></lightning-icon>
                                    </div>
                                </label>
                            </span>
                        </template>
                    </div>

                    <!-- "Show More" menu content -->
                    <div class="slds-listbox_vertical" slot="menu-content">
                        <template
                            for:each={overflowingOptions}
                            for:item="option"
                        >
                            <span
                                if:false={option.hidden}
                                key={option.value}
                                data-element-id="span-checkbox-container"
                                data-value={option.value}
                                onmouseenter={handleEnter}
                                onmouseleave={handleLeave}
                            >
                                <input
                                    class="
                                        avonni-input-choice-set__overflowing-option-input
                                    "
                                    checked={option.isChecked}
                                    disabled={option.disabled}
                                    id={option.value}
                                    name={name}
                                    readonly={readOnly}
                                    type={computedInputType}
                                    value={option.value}
                                    data-checked={option.isChecked}
                                    data-element-id="input-overflowing-option"
                                    onblur={handleBlur}
                                    onchange={handleChange}
                                    onclick={handleClick}
                                    onfocus={handleFocus}
                                    onkeyup={handleKeyUp}
                                />
                                <label
                                    for={option.value}
                                    class="
                                        slds-media
                                        slds-media_small
                                        slds-media_center
                                        slds-listbox__item slds-listbox__option
                                        avonni-input-choice-set__overflowing-option-label
                                    "
                                    data-element-id="label"
                                    data-value={option.value}
                                >
                                    <span
                                        class="
                                            slds-media__figure
                                            slds-listbox__option-icon
                                        "
                                        aria-hidden="true"
                                    >
                                        <lightning-icon
                                            class="
                                                avonni-input-choice-set__overflowing-option-checked-icon
                                            "
                                            icon-name="utility:check"
                                            size="x-small"
                                        ></lightning-icon>
                                    </span>
                                    <span
                                        class="
                                            slds-listbox__option-text
                                            slds-listbox__option-text_entity
                                            avonni-input-choice-set__overflowing-option-label-text
                                            slds-p-vertical_x-small
                                            slds-m-bottom_none
                                        "
                                        >{option.label}</span
                                    >
                                </label>
                            </span>
                        </template>
                    </div>
                </c-primitive-scrollable-container>
            </div>
            <div
                if:true={helpMessage}
                class="slds-form-element__help"
                id="helptext"
                data-helptext
            >
                {helpMessage}
            </div>
        </fieldset>
    </div>
</template>
