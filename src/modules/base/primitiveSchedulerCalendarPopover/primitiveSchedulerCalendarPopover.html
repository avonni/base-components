<template>
    <div
        if:true={show}
        aria-live="polite"
        role="tooltip"
        data-element-id="div-wrapper"
        onmouseenter={handleMouseEnter}
        onmouseleave={handleMouseLeave}
    >
        <c-focus-trap
            data-element-id="avonni-focus-trap"
            onfocusin={handleFocusIn}
            onfocusout={handleFocusOut}
        >
            <div class="slds-popover__header">
                <lightning-button-icon
                    class="
                        slds-is-absolute
                        slds-var-p-horizontal_x-small
                        avonni-scheduler__calendar-show-more-popover-close-button
                    "
                    icon-name="utility:close"
                    variant="bare"
                    data-element-id="lightning-button-icon-show-more-close"
                    data-is-focusable
                    onclick={handleClose}
                ></lightning-button-icon>
                <div
                    class="
                        slds-var-m-horizontal_x-small
                        slds-var-p-bottom_xx-small
                        slds-text-title_caps
                    "
                    data-element-id="div-label"
                >
                    {label}
                </div>
            </div>
            <div
                class="
                    slds-popover__body
                    slds-scrollable_y
                    avonni-primitive-scheduler-calendar-popover__body
                "
                data-element-id="div-body"
                onscroll={handleScroll}
            >
                <div
                    if:false={events.length}
                    class="slds-var-m-horizontal_x-small"
                >
                    There are no events scheduled on this day.
                </div>
                <template for:each={loadedEvents} for:item="occurrence">
                    <c-primitive-scheduler-event-occurrence
                        key={occurrence.key}
                        class="slds-var-p-bottom_xx-small slds-show"
                        color={occurrence.event.color}
                        date-format={dateFormat}
                        disabled={occurrence.event.disabled}
                        event-data={occurrence.event.data}
                        event-name={occurrence.event.name}
                        from={occurrence.from}
                        hidden-actions={hiddenActions}
                        icon-name={occurrence.event.iconName}
                        labels={occurrence.event.labels}
                        occurrence={occurrence}
                        occurrence-key={occurrence.key}
                        read-only={readOnly}
                        reference-line={occurrence.event.referenceLine}
                        resource-key={occurrence.resourceName}
                        resources={resources}
                        timezone={timezone}
                        title={occurrence.title}
                        theme={occurrence.event.theme}
                        to={occurrence.to}
                        variant="calendar-month"
                        data-is-focusable
                        data-element-id="avonni-primitive-scheduler-event-occurrence"
                        data-key={occurrence.key}
                        onprivatecontextmenu={handleEventContextMenu}
                        onprivatedblclick={handleEventDoubleClick}
                        onprivatemousedown={handleEventMouseDown}
                    ></c-primitive-scheduler-event-occurrence>
                </template>
            </div>
        </c-focus-trap>
    </div>
</template>
