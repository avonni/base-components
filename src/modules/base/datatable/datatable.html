<template>
    <div class="avonni-datatable__container">
        <c-primitive-datatable
            if:true={hasGroupBy}
            data-role="header"
            column-widths-mode={columnWidthsMode}
            columns={columns}
            data={records}
            default-sort-direction={defaultSortDirection}
            draft-values={draftValues}
            enable-infinite-loading={enableInfiniteLoading}
            errors={errors}
            hide-checkbox-column={hideCheckboxColumn}
            hide-table-header={hideTableHeader}
            is-loading={isLoading}
            key-field={keyField}
            load-more-offset={loadMoreOffset}
            max-column-width={maxColumnWidth}
            max-row-selection={maxRowSelection}
            min-column-width={minColumnWidth}
            render-config={renderConfig}
            resize-column-disabled={resizeColumnDisabled}
            resize-step={resizeStep}
            row-number-offset={rowNumberOffset}
            selected-rows={selectedRows}
            show-row-number-column={showRowNumberColumn}
            sorted-by={sortedBy}
            sorted-direction={sortedDirection}
            suppress-bottom-bar
            wrap-text-max-lines={wrapTextMaxLines}
            onrowselection={handleDispatchEvents}
            onsort={handleDispatchEvents}
            onresize={handleDispatchEvents}
            onheaderaction={handleDispatchEvents}
            onloadmore={handleDispatchEvents}
            oncellchange={handleDispatchEvents}
            onrowaction={handleDispatchEvents}
            group-by={groupBy}
        ></c-primitive-datatable>
        <c-primitive-datatable
            if:false={hasGroupBy}
            data-role="ungrouped"
            columns={columns}
            data={records}
            column-widths-mode={columnWidthsMode}
            default-sort-direction={defaultSortDirection}
            draft-values={draftValues}
            enable-infinite-loading={enableInfiniteLoading}
            errors={errors}
            hide-checkbox-column={hideCheckboxColumn}
            is-loading={isLoading}
            key-field={keyField}
            load-more-offset={loadMoreOffset}
            max-column-width={maxColumnWidth}
            max-row-selection={maxRowSelection}
            min-column-width={minColumnWidth}
            render-config={renderConfig}
            resize-column-disabled={resizeColumnDisabled}
            resize-step={resizeStep}
            row-number-offset={rowNumberOffset}
            selected-rows={selectedRows}
            show-row-number-column={showRowNumberColumn}
            sorted-by={sortedBy}
            sorted-direction={sortedDirection}
            suppress-bottom-bar
            wrap-text-max-lines={wrapTextMaxLines}
            onrowselection={handleDispatchEvents}
            onsort={handleDispatchEvents}
            onresize={handleDispatchEvents}
            onsave={handleDispatchEvents}
            oncancel={handleDispatchEvents}
            onheaderaction={handleDispatchEvents}
            onloadmore={handleDispatchEvents}
            oncellchange={handleDispatchEvents}
            onrowaction={handleDispatchEvents}
        >
        </c-primitive-datatable>
        <template if:true={hasGroupBy}>
            <c-primitive-group-by-item
                records={groupByRecords}
                columns={columns}
                group-by={groupBy}
                column-widths-mode={columnWidthsMode}
                key-field={keyField}
                default-sort-direction={defaultSortDirection}
                draft-values={draftValues}
                enable-infinite-loading={enableInfiniteLoading}
                errors={errors}
                hide-checkbox-column={hideCheckboxColumn}
                hide-collapsible-icon={hideCollapsibleIcon}
                hide-table-header={hideTableHeader}
                is-loading={isLoading}
                load-more-offset={loadMoreOffset}
                max-column-width={maxColumnWidth}
                max-row-selection={maxRowSelection}
                min-column-width={minColumnWidth}
                render-config={renderConfig}
                resize-column-disabled={resizeColumnDisabled}
                resize-step={resizeStep}
                row-number-offset={rowNumberOffset}
                selected-rows={selectedRows}
                show-row-number-column={showRowNumberColumn}
                sorted-by={sortedBy}
                sorted-direction={sortedDirection}
                wrap-text-max-lines={wrapTextMaxLines}
                onrowselection={handleDispatchEvents}
                onsort={handleDispatchEvents}
                onresize={handleDispatchEvents}
                onsave={handleDispatchEvents}
                oncancel={handleDispatchEvents}
                onheaderaction={handleDispatchEvents}
                onloadmore={handleDispatchEvents}
                oncellchange={handleDispatchEvents}
                onrowaction={handleDispatchEvents}
                onprivateitemregister={handleChildRegister}
            ></c-primitive-group-by-item>
        </template>
        <template if:true={allowSummarize}>
            <table
                data-role="summarize"
                class="slds-table slds-table_bordered slds-table_resizable-cols avonni-datatable__summarize-table_border-top_none"
                role="grid"
            >
                <tbody>
                    <tr>
                        <td if:true={isDatatableEditable}></td>
                        <td if:false={hideCheckboxColumn}></td>
                        <template
                            for:each={computedSummarizeArray}
                            for:item="column"
                        >
                            <td
                                key={column.fieldName}
                                class="avonni-datatable__summarize-td_vertical-align_top"
                                data-column={column.fieldName}
                                role="gridcell"
                            >
                                <template if:true={column.hasSummarizeType}>
                                    <template
                                        for:each={column.summarizeTypes}
                                        for:item="type"
                                    >
                                        <div
                                            key={type.label}
                                            class={column.className}
                                            if:true={type.displaySumType}
                                        >
                                            <div
                                                class="avonni-datatable__summarize-type-text_styling"
                                            >
                                                {type.label}:
                                            </div>
                                            <template if:false={type.count}>
                                                <template
                                                    if:true={column.formattedNumberType}
                                                >
                                                    <lightning-formatted-number
                                                        format-style={type.type}
                                                        value={type.value}
                                                        currency-code={type.typeAttributes.currencyCode}
                                                        currency-display-as={type.typeAttributes.currencyDisplayAs}
                                                        minimum-fraction-digits={type.typeAttributes.minimumFractionDigits}
                                                        maximum-fraction-digits={type.typeAttributes.maximumFractionDigits}
                                                        minimum-integer-digits={type.typeAttributes.minimumIntegerDigits}
                                                        minimum-significant-digits={type.typeAttributes.minimumSignificantDigits}
                                                        maximum-significant-digits={type.typeAttributes.maximumSignificantDigits}
                                                    ></lightning-formatted-number>
                                                </template>
                                                <template
                                                    if:true={column.dateType}
                                                >
                                                    <lightning-formatted-date-time
                                                        value={type.value}
                                                        day={type.typeAttributes.day}
                                                        era={type.typeAttributes.era}
                                                        hour={type.typeAttributes.hour}
                                                        hour12={type.typeAttributes.hour12}
                                                        minute={type.typeAttributes.minute}
                                                        month={type.typeAttributes.month}
                                                        second={type.typeAttributes.second}
                                                        time-zone={type.typeAttributes.timeZone}
                                                        time-zone-name={type.typeAttributes.timeZoneName}
                                                        weekday={type.typeAttributes.weekday}
                                                        year={type.typeAttributes.year}
                                                    ></lightning-formatted-date-time>
                                                </template>
                                                <template if:true={type.mode}>
                                                    <lightning-formatted-text
                                                        value={type.value}
                                                    ></lightning-formatted-text>
                                                </template>
                                            </template>
                                            <template if:true={type.count}>
                                                <lightning-formatted-number
                                                    format-style="decimal"
                                                    value={type.value}
                                                ></lightning-formatted-number>
                                            </template>
                                        </div>
                                    </template>
                                </template>
                            </td>
                        </template>
                    </tr>
                </tbody>
            </table>
        </template>
    </div>
    <div class="avonni-datatable__bottom-bar_styling" if:true={showStatusBar}>
        <div class="slds-grid slds-grid_align-center">
            <lightning-button
                class="slds-button"
                label="Cancel"
                onclick={handleCancel}
            ></lightning-button>
            <lightning-button
                class="slds-button"
                label="Save"
                variant="brand"
                onclick={handleSave}
            ></lightning-button>
        </div>
    </div>
</template>
