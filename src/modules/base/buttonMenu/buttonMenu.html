<template>
    <button
        class={computedButtonClass}
        accesskey={accessKey}
        aria-expanded={computedAriaExpanded}
        aria-haspopup="true"
        disabled={computedDisabled}
        tabindex={buttonTabIndex}
        title={title}
        type="button"
        value={value}
        data-element-id="button"
        onblur={handleButtonBlur}
        onclick={handleButtonClick}
        onfocus={handleButtonFocus}
        onkeydown={handleButtonKeyDown}
    >
        <lightning-spinner
            if:true={isButtonLoading}
            class="avonni-button-menu__spinner"
            alternative-text={loadingStateAlternativeText}
            size={spinnerSize}
            variant="brand"
            data-element-id="spinner"
        ></lightning-spinner>
        <abbr
            if:true={isDraft}
            class="slds-indicator_unsaved slds-p-right_xx-small"
            title={draftAlternativeText}
        >
            *
        </abbr>
        <img
            if:true={iconSrc}
            class={computedImageClass}
            src={iconSrc}
            data-element-id="image"
        />
        <c-primitive-icon
            if:true={prefixIconName}
            aria-hidden="true"
            icon-name={prefixIconName}
            svg-class="slds-button__icon slds-button__icon_left"
            variant="bare"
            data-element-id="avonni-primitive-icon-prefix"
        ></c-primitive-icon>
        {label}
        <c-primitive-icon
            if:true={showIcon}
            class={computedMainIconClass}
            icon-name={iconName}
            size={computedIconSize}
            svg-class={computedIconSvgClass}
            variant="bare"
            data-element-id="avonni-primitive-icon-main"
        ></c-primitive-icon>
        <c-primitive-icon
            if:false={computedHideDownIcon}
            class="slds-grid"
            icon-name="utility:down"
            svg-class={computedDownIconSvgClass}
            variant="bare"
            data-element-id="avonni-primitive-icon-down"
        ></c-primitive-icon>
        <span class="slds-assistive-text">{alternativeText}</span>
    </button>
    <div
        if:true={dropdownOpened}
        class={computedDropdownClass}
        data-element-id="dropdown"
        tabindex="0"
        onfocus={handleDropdownFocus}
        onfocusin={handleDropdownFocusIn}
        onfocusout={handleDropdownFocusOut}
        onkeydown={handleDropdownKeyDown}
        onscroll={handleDropdownScroll}
    >
        <c-focus-trap data-element-id="avonni-focus-trap">
            <div class="avonni-button-menu__dropdown-gap-cover"></div>
            <lightning-spinner
                if:true={showOnlyLoading}
                alternative-text={computedLoadingStateAlternativeText}
                size="small"
                data-element-id="lightning-spinner"
            ></lightning-spinner>
            <lightning-input
                if:true={showSearch}
                class="slds-p-around_small"
                label={searchInputPlaceholder}
                placeholder={searchInputPlaceholder}
                variant="label-hidden"
                type="search"
                value={searchTerm}
                autocomplete="off"
                data-element-id="lightning-input"
                data-is-focusable
                onchange={handleSearch}
            ></lightning-input>
            <div
                if:false={showOnlyLoading}
                class={computedDropdownContentClass}
                data-element-id="div-dropdown-content"
                tabindex="-1"
                onscroll={handleScroll}
            >
                <div
                    class="slds-dropdown__list"
                    role="menu"
                    data-element-id="dropdown-list"
                    onkeydown={handleMenuItemKeyDown}
                    onmouseover={handleMenuItemMouseOver}
                    onprivatehover={handleMenuItemHover}
                    onprivateselect={handleMenuItemSelect}
                >
                    <slot></slot>
                </div>
                <!-- Loading spinner -->
                <div
                    if:true={showInfiniteLoading}
                    class="slds-is-relative slds-p-vertical_large"
                >
                    <lightning-spinner
                        alternative-text={computedLoadingStateAlternativeText}
                        size="small"
                        data-element-id="lightning-spinner-infinite"
                    ></lightning-spinner>
                </div>
            </div>
            <div class={computedFooterContainerClass}>
                <slot
                    name="footer"
                    onslotchange={handleFooterSlotChange}
                ></slot>
            </div>
        </c-focus-trap>
    </div>
</template>
