<template>
    <button
        class={computedButtonClass}
        accesskey={accessKey}
        aria-expanded={computedAriaExpanded}
        aria-haspopup="true"
        disabled={disabled}
        title={title}
        value={value}
        type="button"
        data-element-id="button"
        onclick={handleButtonClick}
        onblur={handleBlur}
        onfocus={handleFocus}
        onkeydown={handleButtonKeyDown}
        onmousedown={handleButtonMouseDown}
    >
        <abbr
            if:true={isDraft}
            class="slds-indicator_unsaved slds-p-right_xx-small"
            title={draftAlternativeText}
            >*</abbr
        >
        {label}
        <img
            if:true={iconSrc}
            class={computedImageClass}
            src={iconSrc}
            data-element-id="image"
        />
        <c-primitive-icon
            if:false={iconSrc}
            class="slds-m-horizontal_xx-small"
            icon-name={iconName}
            svg-class="slds-button__icon"
            variant="bare"
            data-element-id="avonni-primitive-icon-main"
        ></c-primitive-icon>

        <c-primitive-icon
            if:false={computedHideDownIcon}
            icon-name="utility:down"
            svg-class="slds-button__icon slds-button__icon_x-small slds-m-left_xx-small"
            variant="bare"
            data-element-id="avonni-primitive-icon-down"
        ></c-primitive-icon>

        <span class="slds-assistive-text">{alternativeText}</span>
    </button>

    <div
        if:true={dropdownOpened}
        class={computedDropdownClass}
        onmousedown={handleDropdownMouseDown}
        onmouseup={handleDropdownMouseUp}
        onmouseleave={handleDropdownMouseLeave}
        onscroll={handleDropdownScroll}
    >
        <template if:true={isLoading}>
            <lightning-spinner
                size="small"
                alternative-text={computedLoadingStateAlternativeText}
                data-element-id="lightning-spinner"
            ></lightning-spinner>
        </template>
        <template if:false={isLoading}>
            <div
                class="slds-dropdown__list"
                role="menu"
                onprivateselect={handleMenuItemPrivateSelect}
                onprivateblur={handlePrivateBlur}
                onprivatefocus={handlePrivateFocus}
                onmouseover={handleMouseOverOnMenuItem}
                onmouseout={allowBlur}
                onkeydown={handleKeyOnMenuItem}
            >
                <slot></slot>
            </div>
        </template>
    </div>
</template>
