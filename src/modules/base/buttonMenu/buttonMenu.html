<template>
    <button
        class={computedButtonClass}
        accesskey={accessKey}
        aria-expanded={computedAriaExpanded}
        aria-haspopup="true"
        disabled={computedDisabled}
        tabindex={buttonTabIndex}
        title={title}
        type="button"
        value={value}
        data-element-id="button"
        onblur={handleButtonBlur}
        onclick={handleButtonClick}
        onfocus={handleButtonFocus}
        onkeydown={handleButtonKeyDown}
    >
        <lightning-spinner
            if:true={isButtonLoading}
            class="avonni-button-menu__spinner"
            alternative-text={loadingStateAlternativeText}
            size={spinnerSize}
            variant="brand"
            data-element-id="spinner"
        ></lightning-spinner>
        <abbr
            if:true={isDraft}
            class="slds-indicator_unsaved slds-p-right_xx-small"
            title={draftAlternativeText}
        >
            *
        </abbr>
        <img
            if:true={iconSrc}
            class={computedImageClass}
            src={iconSrc}
            data-element-id="image"
        />
        <c-primitive-icon
            if:true={prefixIconName}
            aria-hidden="true"
            icon-name={prefixIconName}
            svg-class="slds-button__icon slds-button__icon_left"
            variant="bare"
            data-element-id="avonni-primitive-icon-prefix"
        ></c-primitive-icon>
        {label}
        <c-primitive-icon
            if:true={showIcon}
            class={computedMainIconClass}
            icon-name={iconName}
            size={computedIconSize}
            svg-class={computedIconSvgClass}
            variant="bare"
            data-element-id="avonni-primitive-icon-main"
        ></c-primitive-icon>
        <c-primitive-icon
            if:false={computedHideDownIcon}
            class="slds-grid"
            icon-name="utility:down"
            svg-class={computedDownIconSvgClass}
            variant="bare"
            data-element-id="avonni-primitive-icon-down"
        ></c-primitive-icon>
        <span class="slds-assistive-text">{alternativeText}</span>
    </button>
    <div
        if:true={dropdownOpened}
        class={computedDropdownClass}
        data-element-id="dropdown"
        onfocus={handleDropdownFocus}
        onfocusin={handleDropdownFocusIn}
        onfocusout={handleDropdownFocusOut}
        onscroll={handleDropdownScroll}
    >
        <div class="avonni-button-menu__dropdown-gap-cover"></div>
        <lightning-spinner
            if:true={isLoading}
            alternative-text={computedLoadingStateAlternativeText}
            size="small"
            data-element-id="lightning-spinner"
        ></lightning-spinner>
        <div
            if:false={isLoading}
            class="slds-dropdown__list"
            role="menu"
            data-element-id="dropdown-list"
            onkeydown={handleMenuItemKeyDown}
            onmouseover={handleMenuItemMouseOver}
            onprivatehover={handleMenuItemHover}
            onprivateselect={handleMenuItemSelect}
        >
            <slot></slot>
            <div if:true={showFooter} class="slds-popover__footer">
                <slot name="footer"></slot>
            </div>
        </div>
    </div>
</template>
