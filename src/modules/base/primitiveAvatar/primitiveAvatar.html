<template>
    <div if:true={showAvatar} class={computedWrapperClass}>
        <!-- Main avatar with link -->
        <a
            if:true={href}
            class={computedAvatarClass}
            href={href}
            data-element-id="avatar-container"
            onclick={handleAnchorTagClick}
        >
            <!-- Image -->
            <img
                if:true={src}
                class="avonni-avatar__image"
                alt={alternativeText}
                src={src}
                title={alternativeText}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={showInitials}
                class={computedInitialsClass}
                title={alternativeText}
                data-element-id="avatar-initials"
            >
                {initials}
            </abbr>
            <!-- Fallback icon -->
            <lightning-icon
                if:true={showIcon}
                class={computedFallbackIconClass}
                alternative-text={alternativeText}
                icon-name={fallbackIconName}
                size={size}
                title={alternativeText}
            ></lightning-icon>
        </a>

        <!-- Main avatar without link-->
        <div
            if:false={href}
            class={computedAvatarClass}
            data-element-id="avatar-container"
        >
            <!-- Image -->
            <img
                if:true={src}
                class="avonni-avatar__image"
                alt={alternativeText}
                src={src}
                title={alternativeText}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={showInitials}
                class={computedInitialsClass}
                aria-hidden="true"
                title={alternativeText}
                data-element-id="avatar-initials"
            >
                {initials}
            </abbr>
            <!-- Fallback icon -->
            <lightning-icon
                if:true={showIcon}
                class={computedFallbackIconClass}
                alternative-text={alternativeText}
                icon-name={fallbackIconName}
                size={size}
                title={alternativeText}
            ></lightning-icon>
        </div>

        <!-- Presence -->
        <div
            if:true={presence}
            class={computedPresenceClass}
            title={presenceTitle}
        ></div>

        <!-- Status -->
        <c-primitive-icon
            if:true={status}
            class={computedStatus.class}
            aria-hidden="true"
            icon-name={computedStatus.iconName}
            title={computedStatus.title}
        ></c-primitive-icon>

        <!-- Entity -->
        <div if:true={showEntity} class={computedEntityClass}>
            <!-- Image -->
            <img
                if:true={entitySrc}
                alt={entityTitle}
                src={entitySrc}
                title={entityTitle}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={entityInitials}
                class={computedEntityInitialsClass}
                aria-hidden="true"
                title={entityTitle}
            >
                {entityInitials}
            </abbr>
            <!-- Fallback icon -->
            <c-primitive-icon
                if:true={showEntityIcon}
                class="avonni-avatar__entity-icon"
                aria-hidden="true"
                icon-name={entityIconName}
                title={entityTitle}
            ></c-primitive-icon>
        </div>

        <!-- Actions -->
        <div
            if:true={showActions}
            class={computedActionClasses}
            data-element-id="action-section"
            onclick={handleStopPropagation}
        >
            <c-button-menu
                if:true={actionMenu}
                alternative-text="Actions"
                hide-down-arrow
                icon-name={actionMenuIcon}
                icon-size={computedActionMenuSize}
                variant="border-filled"
                data-element-id="action-menu-icon"
                onselect={handleActionClick}
            >
                <template for:each={actions} for:item="action">
                    <lightning-menu-item
                        key={action.name}
                        disabled={action.disabled}
                        icon-name={action.iconName}
                        label={action.label}
                        value={action.name}
                    ></lightning-menu-item>
                </template>
            </c-button-menu>
            <c-button-icon
                if:false={actionMenu}
                disabled={action.disabled}
                icon-name={computedActionMenuIcon}
                size={computedActionMenuSize}
                title={action.label}
                value={action.name}
                variant="border-filled"
                data-element-id="action-icon"
                onclick={handleActionClick}
            ></c-button-icon>
        </div>
    </div>
</template>
