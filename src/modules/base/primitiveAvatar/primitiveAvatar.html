<template>
    <div if:true={showAvatar} class={computedWrapperClass}>
        <!-- Main avatar with link -->
        <a
            if:true={href}
            class={computedAvatarClass}
            href={href}
            data-element-id="avatar-container"
            onclick={handleAnchorTagClick}
        >
            <!-- Image -->
            <img
                if:true={src}
                class="avonni-avatar__image"
                alt={alternativeText}
                src={src}
                title={alternativeText}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={showInitials}
                class={computedInitialsClass}
                title={alternativeText}
                data-element-id="avatar-initials"
            >
                {initials}
            </abbr>
            <!-- Fallback icon -->
            <lightning-icon
                if:true={showIcon}
                class={computedFallbackIconClass}
                alternative-text={alternativeText}
                icon-name={fallbackIconName}
                size={size}
                title={alternativeText}
            ></lightning-icon>
        </a>

        <!-- Main avatar without link-->
        <div
            if:false={href}
            class={computedAvatarClass}
            data-element-id="avatar-container"
        >
            <!-- Image -->
            <img
                if:true={src}
                class="avonni-avatar__image"
                alt={alternativeText}
                src={src}
                title={alternativeText}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={showInitials}
                class={computedInitialsClass}
                title={alternativeText}
                data-element-id="avatar-initials"
            >
                {initials}
            </abbr>
            <!-- Fallback icon -->
            <lightning-icon
                if:true={showIcon}
                class={computedFallbackIconClass}
                alternative-text={alternativeText}
                icon-name={fallbackIconName}
                size={size}
                title={alternativeText}
            ></lightning-icon>
        </div>

        <!-- Presence -->
        <div
            if:true={presence}
            class={computedPresenceClass}
            aria-label={presenceTitle}
            title={presenceTitle}
        ></div>

        <!-- Status -->
        <template if:true={status}>
            <c-primitive-icon
                class={computedStatus.class}
                icon-name={computedStatus.iconName}
                title={computedStatus.title}
            ></c-primitive-icon>
            <span class="slds-assistive-text">{computedStatus.title}</span>
        </template>

        <!-- Entity -->
        <div if:true={showEntity} class={computedEntityClass}>
            <!-- Image -->
            <img
                if:true={entitySrc}
                alt={entityTitle}
                src={entitySrc}
                title={entityTitle}
                onerror={handleImageError}
            />
            <!-- Initials -->
            <abbr
                if:true={entityInitials}
                class={computedEntityInitialsClass}
                title={entityTitle}
            >
                {entityInitials}
            </abbr>
            <!-- Fallback icon -->
            <template if:true={showEntityIcon}>
                <c-primitive-icon
                    class="avonni-avatar__entity-icon"
                    icon-name={entityIconName}
                    title={entityTitle}
                ></c-primitive-icon>
                <span class="slds-assistive-text">{entityTitle}</span>
            </template>
        </div>

        <!-- Actions -->
        <div
            if:true={showActions}
            class={computedActionClasses}
            data-element-id="action-section"
            onclick={handleStopPropagation}
        >
            <c-button-menu
                if:true={actionMenu}
                alternative-text="Actions"
                hide-down-arrow
                icon-name={actionMenuIcon}
                icon-size={actionMenuSize}
                variant="border-filled"
                data-element-id="action-menu-icon"
                onselect={handleActionClick}
            >
                <template for:each={actions} for:item="action">
                    <lightning-menu-item
                        key={action.name}
                        disabled={action.disabled}
                        icon-name={action.iconName}
                        label={action.label}
                        value={action.name}
                    ></lightning-menu-item>
                </template>
            </c-button-menu>
            <button
                if:false={actionMenu}
                class="
                    avonni-avatar-action-button
                    slds-button slds-button_icon slds-button_icon-border-filled
                "
                disabled={action.disabled}
                title={action.label}
                type="button"
                value={action.name}
                data-element-id="action-icon"
                onclick={handleActionClick}
            >
                <c-primitive-icon
                    class="avonni-avatar-action-button-icon"
                    icon-name={computedActionMenuIcon}
                    data-element-id="primitive-icon-action"
                ></c-primitive-icon>
            </button>
        </div>
    </div>
</template>
