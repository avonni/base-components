<template>
    <div
        class="avonni-visual-picker__wrapper_full-height"
        data-element-id="div-wrapper"
    >
        <fieldset
            class="
                avonni-visual-picker__fieldset_full-height
                slds-form-element slds-grid slds-grid_vertical
            "
            aria-required={required}
            data-element-id="fieldset"
        >
            <legend
                class="
                    slds-form-element__legend slds-form-element__label
                    avonni-visual-picker__label
                "
                data-element-id="legend"
            >
                <abbr
                    if:true={required}
                    class="slds-required"
                    title={requiredAlternativeText}
                    data-element-id="abbr"
                    >*
                </abbr>
                {label}
            </legend>
            <div
                class="slds-form-element__control slds-scrollable_y slds-grow"
                data-element-id="div-items-wrapper"
                onscroll={handleScroll}
            >
                <c-layout multiple-rows>
                    <template for:each={visibleItems} for:item="item">
                        <c-layout-item
                            if:true={item.visible}
                            key={item.value}
                            large-container-size={largeContainerCols}
                            medium-container-size={mediumContainerCols}
                            size={cols}
                            small-container-size={smallContainerCols}
                            data-element-id="div-item-wrapper"
                            onprivatelayoutitemconnected={handleItemRendered}
                        >
                            <div class={computedVisualPickerClass}>
                                <input
                                    disabled={item.disabled}
                                    id={item.value}
                                    name={name}
                                    type={type}
                                    value={item.value}
                                    data-element-id="input"
                                    onblur={handleBlur}
                                    onchange={handleChange}
                                    onclick={handleClick}
                                    onfocus={handleFocus}
                                    onkeyup={handleKeyUp}
                                />
                                <label
                                    for={item.value}
                                    data-element-id="label"
                                    onmouseenter={handleMouseEnter}
                                    onmouseleave={handleMouseLeave}
                                >
                                    <span class={computedVisualPickerTypeClass}>
                                        <span
                                            if:true={item.displayCheckCoverable}
                                            class={item.computedSelectedClass}
                                        >
                                            <lightning-icon
                                                icon-name="utility:check"
                                                size="medium"
                                                variant="inverse"
                                            ></lightning-icon>
                                        </span>
                                        <!-- Figure Container -->
                                        <div
                                            class={item.computedNotSelectedClass}
                                        >
                                            <!-- Figure Image (Horizontal) -->
                                            <div
                                                if:true={item.layoutIsHorizontal}
                                                style={item.computedImgLayoutStyle}
                                                class="
                                                    avonni-visual-picker__figure-image-container-horizontal
                                                "
                                            >
                                                <div
                                                    style={item.computedImgContainerStyle}
                                                    class="
                                                        avonni-visual-picker__figure-image-container
                                                    "
                                                >
                                                    <img
                                                        class={computedImageMediaClass}
                                                        alt={item.imgAlternativeText}
                                                        draggable="false"
                                                        loading="lazy"
                                                        src={item.imgSrc}
                                                        style={item.computedImgStyle}
                                                        data-element-id="avonni-visual-picker-img-horizontal"
                                                        onerror={handleItemImageError}
                                                    />
                                                </div>
                                            </div>
                                            <!-- Figure Body -->
                                            <div
                                                if:true={item.hasBodyContent}
                                                style={item.computedBodyLayoutStyle}
                                                class="
                                                    avonni-visual-picker__figure-body-container
                                                "
                                            >
                                                <div
                                                    class={item.computedBodyClass}
                                                >
                                                    <!-- Position Top -->
                                                    <div
                                                        class={item.computedBodyContentTopClass}
                                                    >
                                                        <c-primitive-visual-picker-header
                                                            if:true={item.headerIsTop}
                                                            class="
                                                                avonni-visual-picker__figure-header
                                                            "
                                                            alternative-text={item.avatarAltText}
                                                            avatar={item.avatar}
                                                            avatar-position={item.avatarPosition}
                                                            checked={item.checked}
                                                            description={item.description}
                                                            hide-avatar-top-bottom={item.avatarTopHidden}
                                                            hide-description={item.descriptionTopHidden}
                                                            hide-title={item.titleTopHidden}
                                                            size={size}
                                                            title={item.title}
                                                        ></c-primitive-visual-picker-header>
                                                        <div
                                                            if:true={item.imgIsTop}
                                                            style={item.computedImgContainerStyle}
                                                            class="
                                                                avonni-visual-picker__figure-image-container
                                                                avonni-visual-picker__figure-image-top-container
                                                            "
                                                        >
                                                            <img
                                                                class={computedImageMediaClass}
                                                                alt={item.imgAlternativeText}
                                                                draggable="false"
                                                                loading="lazy"
                                                                src={item.imgSrc}
                                                                style={item.computedImgStyle}
                                                                data-element-id="avonni-visual-picker-img-top"
                                                                onerror={handleItemImageError}
                                                            />
                                                        </div>
                                                    </div>
                                                    <!-- Position Center -->
                                                    <div
                                                        class={item.computedBodyContentCenterClass}
                                                    >
                                                        <c-primitive-visual-picker-header
                                                            if:true={item.headerIsCenter}
                                                            class="
                                                                avonni-visual-picker__figure-header
                                                            "
                                                            alternative-text={item.avatarAltText}
                                                            avatar={item.avatar}
                                                            avatar-position={item.avatarPosition}
                                                            checked={item.checked}
                                                            description={item.description}
                                                            hide-avatar-top-bottom={item.avatarCenterHidden}
                                                            hide-description={item.descriptionCenterHidden}
                                                            hide-title={item.titleCenterHidden}
                                                            size={size}
                                                            title={item.title}
                                                        ></c-primitive-visual-picker-header>
                                                        <div
                                                            if:true={item.imgIsCenter}
                                                            style={item.computedImgContainerStyle}
                                                            class="
                                                                avonni-visual-picker__figure-image-container
                                                                avonni-visual-picker__figure-image-center-container
                                                            "
                                                        >
                                                            <img
                                                                style={item.computedImgStyle}
                                                                class={computedImageMediaClass}
                                                                alt={item.imgAlternativeText}
                                                                draggable="false"
                                                                loading="lazy"
                                                                src={item.imgSrc}
                                                                data-element-id="avonni-visual-picker-img-center"
                                                                onerror={handleItemImageError}
                                                            />
                                                        </div>
                                                        <div
                                                            if:true={item.hasFields}
                                                            class="
                                                                slds-m-top_xx-small
                                                                avonni-visual-picker__item-fields-container
                                                            "
                                                        >
                                                            <c-layout
                                                                multiple-rows
                                                                data-element-id="fields-container"
                                                            >
                                                                <template
                                                                    for:each={item.fields}
                                                                    for:item="field"
                                                                >
                                                                    <c-layout-item
                                                                        key={field.value}
                                                                        class="
                                                                            avonni-visual-picker__item-fields
                                                                            slds-truncate
                                                                        "
                                                                        size={fieldAttributes.cols}
                                                                    >
                                                                        <c-output-data
                                                                            class="
                                                                                avonni-visual-picker__fields-label
                                                                            "
                                                                            label={field.label}
                                                                            type={field.type}
                                                                            type-attributes={field.typeAttributes}
                                                                            value={field.value}
                                                                            variant={fieldAttributes.variant}
                                                                        ></c-output-data>
                                                                    </c-layout-item>
                                                                </template>
                                                            </c-layout>
                                                        </div>
                                                    </div>
                                                    <!-- Position Bottom -->
                                                    <div
                                                        class={item.computedBodyContentBottomClass}
                                                    >
                                                        <c-primitive-visual-picker-header
                                                            if:true={item.headerIsBottom}
                                                            class="
                                                                avonni-visual-picker__figure-header
                                                            "
                                                            alternative-text={item.avatarAltText}
                                                            avatar={item.avatar}
                                                            avatar-position={item.avatarPosition}
                                                            checked={item.checked}
                                                            description={item.description}
                                                            hide-avatar-top-bottom={item.avatarBottomHidden}
                                                            hide-description={item.descriptionBottomHidden}
                                                            hide-title={item.titleBottomHidden}
                                                            size={size}
                                                            title={item.title}
                                                        ></c-primitive-visual-picker-header>
                                                        <div
                                                            if:true={item.imgIsBottom}
                                                            style={item.computedImgContainerStyle}
                                                            class="
                                                                avonni-visual-picker__figure-image-container
                                                                avonni-visual-picker__figure-image-bottom-container
                                                            "
                                                        >
                                                            <img
                                                                style={item.computedImgStyle}
                                                                class={computedImageMediaClass}
                                                                alt={item.imgAlternativeText}
                                                                draggable="false"
                                                                loading="lazy"
                                                                src={item.imgSrc}
                                                                data-element-id="avonni-visual-picker-img-bottom"
                                                                onerror={handleItemImageError}
                                                            />
                                                        </div>
                                                        <div
                                                            if:true={item.hasTags}
                                                            class="
                                                                avonni-visual-picker__tags-container
                                                            "
                                                        >
                                                            <c-chip-container
                                                                class="
                                                                    avonni-visual-picker__tags
                                                                "
                                                                is-collapsible
                                                                items={item.tags}
                                                                data-element-id="tags-container"
                                                            ></c-chip-container>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </span>
                                    <span
                                        if:true={item.hasTitleOrDescription}
                                        class="slds-visual-picker__body"
                                    >
                                        <span
                                            class="
                                                avonni-visual-picker__item-title
                                            "
                                        >
                                            {item.itemTitle}
                                        </span>
                                        <span
                                            class="
                                                avonni-visual-picker__item-description
                                            "
                                        >
                                            <lightning-formatted-rich-text
                                                title={item.itemDescriptionTitle}
                                                value={item.itemDescription}
                                                data-element-id="lightning-formatted-rich-text-description"
                                            ></lightning-formatted-rich-text>
                                        </span>
                                    </span>
                                    <span
                                        if:true={item.displayCheckNonCoverable}
                                        class={computedCheckIconContainerClass}
                                    >
                                        <lightning-icon
                                            class="slds-icon-text-check"
                                            icon-name="utility:check"
                                            size="x-small"
                                            variant="inverse"
                                        ></lightning-icon>
                                    </span>
                                </label>
                            </div>
                        </c-layout-item>
                    </template>
                    <c-layout-item
                        if:true={showButtonOrSpinner}
                        class={computedButtonSpinnerWrapperClass}
                        size="12"
                        data-element-id="div-button-spinner-wrapper"
                    >
                        <!-- Loading spinner -->
                        <lightning-spinner
                            if:true={isLoading}
                            class="slds-spinner_container"
                            alternative-text={loadingStateAlternativeText}
                            size="small"
                            data-element-id="loading-spinner"
                        ></lightning-spinner>
                        <!-- Show more button -->
                        <lightning-button
                            if:true={showMoreButton}
                            class="
                                slds-m-vertical_small
                                slds-show
                                avonni-visual-picker__show-more-button
                            "
                            disabled={isLoading}
                            icon-name={computedShowMoreButtonIconName}
                            label={computedShowMoreButtonLabel}
                            title={computedShowMoreButtonLabel}
                            data-element-id="show-more-button"
                            onclick={handleToggleShowMoreButton}
                        ></lightning-button>
                    </c-layout-item>
                </c-layout>
            </div>
        </fieldset>
        <div
            if:true={helpMessage}
            class="slds-form-element__help"
            id="help-message"
            role="alert"
            data-element-id="div-help-message"
            data-help-message
        >
            {helpMessage}
        </div>
    </div>
</template>
