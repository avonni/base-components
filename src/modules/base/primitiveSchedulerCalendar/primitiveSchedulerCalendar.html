<!--
/**
 * BSD 3-Clause License
 *
 * Copyright (c) 2021, Avonni Labs, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * - Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * - Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
-->

<template>
    <div
        class="slds-grid slds-is-relative avonni-scheduler__wrapper"
        data-element-id="div-schedule-wrapper"
        onmousemove={handleMouseMove}
    >
        <!-- Left panel -->
        <div class={firstColClass} data-element-id="div-first-column">
            <div class="slds-p-around_small">
                <c-calendar></c-calendar>

                <c-input-choice-set
                    is-multi-select
                    label="Resources"
                    options={resourceOptions}
                ></c-input-choice-set>
            </div>

            <!-- Resizing splitter -->
            <div class="slds-is-relative">
                <div
                    class={splitterClass}
                    data-element-id="div-splitter"
                    onmousedown={handleSplitterMouseDown}
                >
                    <div
                        class="
                            slds-theme_shade
                            slds-grid slds-grid_vertical-align-center
                            slds-wrap
                        "
                    >
                        <lightning-button-icon
                            if:true={showCollapseLeft}
                            class="avonni-scheduler__splitter-icon"
                            icon-name="utility:left"
                            variant="bare"
                            data-element-id="lightning-button-icon-collapse-col"
                            onclick={handleHideFirstCol}
                        ></lightning-button-icon>
                        <lightning-button-icon
                            if:true={showCollapseRight}
                            class="avonni-scheduler__splitter-icon"
                            icon-name="utility:right"
                            variant="bare"
                            data-element-id="lightning-button-icon-open-col"
                            onclick={handleOpenFirstCol}
                        ></lightning-button-icon>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule -->
        <div class="slds-grid slds-col">
            <!-- Hours -->
            <c-primitive-scheduler-header-group
                class="avonni-scheduler__header"
                available-time-frames={availableTimeFrames}
                available-time-spans={availableTimeSpans}
                headers={hourHeaders}
                scroll-left-offset={firstColWidth}
                start={start}
                time-span={dayTimeSpan}
                variant="vertical"
                zoom-to-fit={zoomToFit}
                data-element-id="avonni-primitive-scheduler-header-group-vertical"
                onprivatecellsizechange={handleHeaderCellSizeChange}
                onprivateheaderchange={handleVerticalHeaderChange}
            ></c-primitive-scheduler-header-group>

            <div class="slds-col">
                <!-- Day(s) header -->
                <c-primitive-scheduler-header-group
                    class="avonni-scheduler__header slds-border_left"
                    available-days-of-the-week={availableDaysOfTheWeek}
                    available-time-spans={availableTimeSpans}
                    headers={dayHeaders}
                    start={start}
                    time-span={timeSpan}
                    zoom-to-fit
                    data-element-id="avonni-primitive-scheduler-header-group-horizontal"
                    onprivatecellsizechange={handleHeaderCellSizeChange}
                    onprivateheaderchange={handleHorizontalHeaderChange}
                ></c-primitive-scheduler-header-group>

                <!-- Multi day events -->
                <div
                    if:true={multiDayEvents.length}
                    class="slds-border_left slds-theme_shade slds-is-relative"
                    data-element-id="div-multi-day-events-wrapper"
                >
                    <div
                        class="
                            slds-grid
                            avonni-primitive-scheduler-calendar__inherit-height
                        "
                    >
                        <!-- Cells -->
                        <template
                            for:each={multiDayEventsCellGroup.cells}
                            for:item="cell"
                        >
                            <div
                                key={cell.start}
                                class="
                                    slds-col
                                    slds-border_right slds-border_bottom
                                    avonni-primitive-scheduler-calendar__inherit-height
                                "
                                data-element-id="div-cell"
                                data-end={cell.end}
                                data-start={cell.start}
                                oncontextmenu={handleEmptySpotContextMenu}
                                onmousedown={handleMouseDown}
                                ondblclick={handleDoubleClick}
                            ></div>
                        </template>
                    </div>
                    <template for:each={multiDayEvents} for:item="event">
                        <template
                            for:each={event.occurrences}
                            for:item="occurrence"
                        >
                            <c-primitive-scheduler-event-occurrence
                                key={occurrence.key}
                                color={event.color}
                                header-cells={eventHeaderCells}
                                cell-duration={dayCellDuration}
                                cell-height={multiDayCellHeight}
                                cell-width={cellWidth}
                                date-format={dateFormat}
                                disabled={event.disabled}
                                event-data={event.data}
                                event-name={event.name}
                                from={occurrence.startOfFrom}
                                icon-name={event.iconName}
                                labels={event.labels}
                                occurrence={occurrence}
                                occurrence-key={occurrence.key}
                                read-only={readOnly}
                                resource-key={occurrence.resourceName}
                                resources={computedResources}
                                title={occurrence.title}
                                theme={event.theme}
                                to={occurrence.endOfTo}
                                variant="timeline-horizontal"
                                zoom-to-fit={zoomToFit}
                                data-element-id="avonni-primitive-scheduler-event-occurrence-multi-day"
                                data-event-name={event.name}
                                data-key={occurrence.key}
                                onprivatefocus={handleEventFocus}
                                onprivateblur={handleHideDetailPopover}
                                onprivatecontextmenu={handleEventContextMenu}
                                onprivatedisabledcontextmenu={handleEmptySpotContextMenu}
                                onprivatemouseenter={handleEventMouseEnter}
                                onprivatemouseleave={handleHideDetailPopover}
                                onprivatedblclick={handleEventDoubleClick}
                                onprivatedisableddblclick={handleDoubleClick}
                                onprivatemousedown={handleMultiDayEventMouseDown}
                                onprivatedisabledmousedown={handleMouseDown}
                            ></c-primitive-scheduler-event-occurrence>
                        </template>
                    </template>
                </div>

                <div
                    class="slds-is-relative slds-grid slds-theme_default"
                    data-element-id="div-schedule-body"
                >
                    <template
                        for:each={columns}
                        for:item="column"
                        for:index="index"
                    >
                        <div
                            key={column.weekday}
                            class="slds-col"
                            data-element-id="div-column"
                            data-index={index}
                        >
                            <!-- Cells -->
                            <template for:each={column.cells} for:item="cell">
                                <div
                                    key={cell.start}
                                    class="
                                        avonni-scheduler__calendar-cell
                                        slds-border_right slds-border_bottom
                                        slds-p-around_none
                                    "
                                    data-element-id="div-cell"
                                    data-end={cell.end}
                                    data-start={cell.start}
                                    oncontextmenu={handleEmptySpotContextMenu}
                                    onmousedown={handleMouseDown}
                                    ondblclick={handleDoubleClick}
                                ></div>
                            </template>
                        </div>
                    </template>

                    <!-- Events -->
                    <div class="avonni-scheduler__events slds-is-absolute">
                        <template
                            if:true={singleDayEvents.length}
                            for:each={singleDayEvents}
                            for:item="event"
                        >
                            <div key={event.key}>
                                <template
                                    for:each={event.occurrences}
                                    for:item="occurrence"
                                >
                                    <c-primitive-scheduler-event-occurrence
                                        key={occurrence.key}
                                        color={event.color}
                                        header-cells={eventHeaderCells}
                                        cell-duration={hourCellDuration}
                                        cell-height={cellHeight}
                                        cell-width={cellWidth}
                                        date-format={dateFormat}
                                        disabled={event.disabled}
                                        event-data={event.data}
                                        event-name={event.name}
                                        from={occurrence.from}
                                        icon-name={event.iconName}
                                        labels={event.labels}
                                        occurrence={occurrence}
                                        occurrence-key={occurrence.key}
                                        read-only={readOnly}
                                        reference-line={event.referenceLine}
                                        resource-key={occurrence.resourceName}
                                        resources={computedResources}
                                        title={occurrence.title}
                                        theme={event.theme}
                                        to={occurrence.to}
                                        variant="calendar"
                                        zoom-to-fit={zoomToFit}
                                        data-weekday={occurrence.fromWeekday}
                                        data-element-id="avonni-primitive-scheduler-event-occurrence-single-day"
                                        data-event-name={event.name}
                                        data-key={occurrence.key}
                                        onprivatefocus={handleEventFocus}
                                        onprivateblur={handleHideDetailPopover}
                                        onprivatecontextmenu={handleEventContextMenu}
                                        onprivatedisabledcontextmenu={handleEmptySpotContextMenu}
                                        onprivatemouseenter={handleEventMouseEnter}
                                        onprivatemouseleave={handleHideDetailPopover}
                                        onprivatedblclick={handleEventDoubleClick}
                                        onprivatedisableddblclick={handleDoubleClick}
                                        onprivatemousedown={handleEventMouseDown}
                                        onprivatedisabledmousedown={handleMouseDown}
                                    ></c-primitive-scheduler-event-occurrence>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
